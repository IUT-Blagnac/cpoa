:moduleTitle: R3.04 Qualité
:authorDefault:  BUT/Info/S3/R3.04

:tdnum: TP3 - Patron Stratégie

:sourcedir: src/java/TD1

include::definitions.txt[]

// ATTENTION !
// Enlevé linkcss car car génére les css à côté du fichier html
:linkcss:

// L'enlève au besoin (! undefines the variable)
// :!linkcss:

:sourcedir: src/java/TD2

:doctitle:  {moduleTitle} - Sujet {tdnum}
ifdef::eleve[]
:doctitle:  {moduleTitle} - Sujet {tdnum}
endif::eleve[]
ifdef::prof[]
:doctitle: {moduleTitle} - Support {tdnum}
endif::prof[]
ifdef::todoprof[]
:doctitle: {moduleTitle} - DEROULEMENT SEANCE PROF {tdnum}
endif::todoprof[]

:icons: font

= {doctitle}
:Author:  {authorDefault}
:lang: fr
:slideshowlocation: Your computer
:copyright: {date={localdate}}, {slideshowlocation} *** {author} *** Powered by AsciiDoc and W3C Slidy &#169; 
:toc-title: Table des Matières
:toc: left
:incremental!:
:source-highlighter: pygments
:numbered:
:iconsdir: icons/
:icons: true
:imagesdir: images

// eleve : sujet pour élèves
// prof : support prof pour séance
// todoprof : support AVEC EXPLICATIOSN DEROULEMENT pour profs

//----------- définitions --------------
:sitecours: http://jmbruel.github.io/cpoa/[Support de Cours]
:pre: PreReq
:objtd: ObjTD
:duree: Durée
:depot: À rendre
:lien: Lien
:img: img

//-------------------- Warning si correction -----------
ifdef::prof[]
[CAUTION]
.Version corrigée
=====
Cette version comporte des indications pour les
réponses aux exercices.
=====
endif::prof[]

//-------------------- Cartouche d'en-tête -----------
[[cartouche]]
[align="left",cols="1,10a",width="90%"]
|======================
| {pre}		|
. Je sais programmer en {java}.
. J'ai conscience qu'il faut réfléchir avant de se lancer dans le codage.
. J'ai compris ce qu'est un patron.
. J'ai réalisé le TD `BonChoco` et donc connait le patron Singleton!
| {objtd}	| Comprendre ce qu'est une *conception* et implémenter mon deuxième patron.
| {duree}	| *2* TP de 1,5h (sur 2 semaines).
|======================

== Rappel sur le patron Singleton

[[Singleton]]
[icon="pattern.jpeg"]
[NOTE]
.Design pattern : *Singleton*
====
include::pattern/singleton.txt[]
====

// TIP: N'hésitez pas à (re)lire régulièrement le {sitecours}.

== `Singleton` dans la jre standard

On trouve des implémentations de Singleton dans le jre standard.

=== Runtime

. Etudiez la documentation de la classe `Runtime` : link:https://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/lang/Runtime.html[elle se trouve ici, en version java 14]
. Créez une classe avec un une méthoide `main()`.
. Essayer de créer un objet de la classe `Runtime`. Et ce possible apr un new ? Pourquoi à votre avis ?
+
ifdef::prof[]
[%collapsible]
.Solution
====
Car construite ainis cf. doc.
  Every Java application has a single instance of class Runtime that allows the application to interface with the environment in which the application is running. The current runtime can be obtained from the getRuntime method.
  An application cannot create its own instance of this class.
====
endif::prof[]
. Récupérer un objet `Runtime` et avec cet objet :

..  Affichez les informations sur : le nombre de procésseurs disponibles, la quantité de mémoire maximum, la quantioté de mémoire totale, la quantité de mémoire libre, la version de la jre au runtime
..  Etudiez la mémoire de la méthode `gc()`. A quoi sert-elle ?
..  Essayez la méthode `exit()` avec -20 en paramètre.
. Vous comprenez maintenant pourquoi runtime est un `Singleton`.

===  Desktop


. Etudiez la documentation de la classe `Desktop (java.awt)` : link:https://docs.oracle.com/en/java/javase/14/docs/api/java.desktop/java/awt/Desktop.html[elle se trouve ici, en version java 14]

. Récupérer un objet `Desktop` et avec cet objet :
..  Ouvrez dans votre OS la page `https://www.iut-blagnac.fr/fr/` (1 ligne)
..  Ouvrez dans votre OS la page `https://www.iut-blagnac.fr/fr/` (1 ligne)
..  Ouvrez dans votre OS le fichier java que vous êtes en train d'éditer (sous Eclipse, le path sera quelque chose genre `./src/...` en notation Unix)
..  Essayez d'ouvrir l'outil de messagerie pour envoyer un mail. Vous pouvez chercher sur internet comment construire une URI `mailto` en java (a minima, `URI` avec en paramètre `"mailto:nom.prenom@adresse.fr"`)
+
ifdef::prof[]
[%collapsible]
.Solution
====
autre solution d.mail( new URI("mailto", "andre.peninou@univ-tlse2.fr", null));
====
endif::prof[]
. Vous pouvez comparez les résultats obtenus sur différentes machines (PC persos) qui n'ouvriront pas les mêmes application suivant le cas (chrome/firefox/opera, thunderbird/outlook/gmail, notpad++/vscode/...) 

:prof: dfdf

//////
== Éléments utiles pour les TPs

=== Fichiers utiles pour la génération de modèles

- le link:util/plantuml.bat[plantuml.bat]
- la link:util/plantUmlDoclet.jar[doclet pour javadoc]
- le link:util/plantuml.jar[jar plantuml]

=== Plugins eclipse utiles

- http://infinitest.github.io/[InfiniTest]
- Le plugin PlantUML, que vous pourrez installer comme ceci ({eclipse} Luna!):
+
image::market.png[link="images/market.png",width=30%]
image::plugin.png[link="images/plugin.png",width=50%]
+
Ce qui permet, non seulement d'avoir un éditeur pour plantUML et d'immédiatement
voir le rendu graphique (à condition d'avoir ouvert la vue par menu:Window[Show View > Other... > PlantUML]),
mais aussi d'avoir immédiatement le source PlantUML et le rendu UML de vos classes java en édition
(cf. <<eclipse-plant,ci-dessous>>)!
+
[[eclipse-plant]]
.PlantUML en temps réel
image::eclipse-plant.png[link="images/eclipse-plant.png",width=100%]

//////

//////
== Rappel sur le patron Singleton

[[Singleton]]
[icon="pattern.jpeg"]
[NOTE]
.Design pattern : *Singleton*
====
include::pattern/singleton.txt[]
====

TIP: N'hésitez pas à (re)lire régulièrement le {sitecours}.

//////

//////

== Reprise du TD 2 en mode Dojo (1ère séance de TP)

Nous allons reprendre succinctement
le http://iut-blagnac.github.io/cpoa/TD2.html[TD2] en mode
http://fr.wikipedia.org/wiki/Coding_Dojo[Coding Dojo] en espérant
que cela vous donne envie de participer à ceux organisés certains jeudi à l'IUT.

=== Le principe :

. Le prof de TP initie l'exercice en ouvrant un eclipse et en commençant un
test qui commence par échouer et qui "passera" quand la fonctionalité attendue
sera implémentée et fonctionnelle.
. Il vérifie que son test échoue bien
+
TIP: On pourra avantageusement installer le plug-in eclipse
http://infinitest.github.io/[InfiniTest] qui permet de runner les tests à
chaque sauvegarde (cf. plus haut)
+
. Il fait en sorte que le test passe au vert  le plus vite possible
. Il "refactor" éventuellement (faire passer le test au vert mais de façon
  intelligente, éviter la duplication de code, réorganiser les classes, etc.)
. Quand tout est au vert on passe à une fonctionnalité suivante

=== Les règles

- Toutes les 5 minutes (timer sonore) on change de personne aux commandes
(au clavier/souris en l'occurence)
- Il faut un "maître du temps"
- Tout le monde participe au codage (et ne fait pas du code de son côté)
+
NOTE: Les machines ne sont donc pas utiles pour cette partie! Seule la machine
connectée au vidéoprojecteur est utilisée.
+
- Le volontariat c'est mieux, mais le prof est libre d'organiser le tour de rôle.
- En 90' de TP on peut faire passer 18 personnes, donc tout le monde y passe et
le plus tôt est en général le moins compliqué.
- Merci à ceux qui ont déjà participé aux coding dojos de montrer l'exemple ;-)

////// 


== Bouilleur de chocolat

Nous allons reprendre succinctement le TD sur le Bouilleur de chocolat.

Vous pouvez travailler cette partie en binomes ppour aller plus vite.

. *Reprendre le TD4* sur la partie Singleton du `BouilleurChocolat` et programmer la classe :
* Faire attention au constructeur
* Faire attention à l'attribut privé/static
* Faire attention à la méthode public/static
. Faire un petit main de test avce la `BouilleurChocolat` : faire remplir, bouillir et vider du chocolat.
. Comment faire un test qui assure que votre clsse est bien un Singleton, qu'on ne peut pas créer un 2° objet `BouilleurChocolat` et qu'on travaille toiujours avec le même objet ? *Programmez ces tests*.



== Jeu d'aventure

=== Mise en oeuvre de Singleton

En reprenant le jeu d'aventure du TP1 :

.Un jeu d'aventure minimaliste
image::aventure.png[link="images/aventure.png"]

Implémentez le patron singleton comme demandé à la
http://iut-blagnac.github.io/cpoa/TD2.html#_et_si_on_améliorait_le_jeu_d_aventure_avec_singleton[section 4.2 du TD2].

=== Modèles et tests d'architecture

. En utilisant la doclet pour Javadoc de {plantUML}, comme au TP1, générez votre diagramme
de classe automatiquement
. Réalisez un test en Java de votre architecture, en vous inspirant du code de
test qui vérifie quelques points simples de l'architecture de l'application `SuperCanard` :
+
.Test du patron _Strategy_ sur les `Canard` en Ruby (source link:src/java/TD1/checkModel.rb[ici])
[source,ruby]
----------
include::src/java/TD1/checkModel.rb[lines=8..200]
----------

:numbered!:
[appendix]
== Pour aller plus loin

Reprenez les section "pour aller plus loin" des TDs 1 et 2.

ifndef::compact[]
== About...

****************************************************************
Document réalisé par mailto:{email}[{author}] via  {asciidoctorlink} (version `{asciidoctor-version}`) de 'Dan Allen', lui même basé sur {asciidoc}.
Pour l'instant ce document est libre d'utilisation et géré par la 'Licence Creative Commons'.
image:88x31.png["Licence Creative
Commons",style="border-width:0",link="http://creativecommons.org/licenses/by-sa/3.0/"]
http://creativecommons.org/licenses/by-sa/3.0/[licence Creative Commons Paternité - Partage à l&#39;Identique 3.0 non transposé].
****************************************************************
endif::compact[]
