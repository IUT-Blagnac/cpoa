<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.1">
<meta name="author" content="Dut/Info-S3/M3105">
<meta name="copyright" content="{date=2014-11-20}, IUT Blagnac *** Dut/Info-S3/M3105 *** Powered by AsciiDoc and W3C Slidy &amp;#169;">
<title>CPOA - Support TD 3</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="./pygments-default.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>CPOA - Support TD 3</h1>
<div class="details">
<span id="author" class="author">Dut/Info-S3/M3105</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_rappel_du_cours">1. Rappel du cours</a></li>
<li><a href="#_le_singleton_pour_le_jeu_d_aventure">2. Le singleton pour le jeu d&#8217;aventure</a>
<ul class="sectlevel2">
<li><a href="#_et_si_on_améliorait_le_jeu_d_aventure_avec_singleton">2.1. Et si on améliorait le jeu d&#8217;aventure avec Singleton?</a></li>
<li><a href="#_problème_du_main_de_test_du_jeu_d_aventure">2.2. Problème du main de test du jeu d&#8217;aventure</a></li>
</ul>
</li>
<li><a href="#_le_patron_fabrique">3. Le patron Fabrique</a></li>
<li><a href="#_pour_aller_plus_loin">Pour aller plus loin</a></li>
<li><a href="#_about">About&#8230;&#8203;</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<img src="images/icons/caution.png" alt="Caution">
</td>
<td class="content">
<div class="title">Version corrigée</div>
<div class="paragraph">
<p>Cette version comporte des indications pour les
réponses aux exercices.</p>
</div>
</td>
</tr>
</table>
</div>
<table id="cartouche" class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 9%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PreReq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1. Je sais programmer en <a href="https://www.java.com/fr/">Java</a>.
2. J&#8217;ai conscience qu&#8217;il faut réfléchir avant de se lancer dans le codage.
3. Je maîtrise les concepts objet de base (héritage, polymorphisme, &#8230;&#8203;).
4. J&#8217;ai compris ce qu&#8217;est un patron et j&#8217;ai grand soif d&#8217;en apprendre d&#8217;autres que
<em>Strategy</em> et Singleton</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ObjTD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aborder le patron <strong>fabrique</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Durée</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong> TD et <strong>2</strong> TP de 1,5h (sur 2 semaines).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_rappel_du_cours"><a class="link" href="#_rappel_du_cours">1. Rappel du cours</a></h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="images/icons/tip.png" alt="Tip">
</td>
<td class="content">
N&#8217;hésitez pas à (re)lire régulièrement le <a href="http://iut-blagnac.github.io/cpoa/">Support de Cours</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_le_singleton_pour_le_jeu_d_aventure"><a class="link" href="#_le_singleton_pour_le_jeu_d_aventure">2. Le singleton pour le jeu d&#8217;aventure</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Peut-on combiner les deux derniers patrons vus en TD (<em>Strategy</em> et Singleton)?
En effet, les comportements sont portés par des objets pour l&#8217;aspect algorithme,
mais il n&#8217;y a pas de raison de ne pas les partagés entre tous les objets qui
"utilisent" ce comportement?!</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
<div class="paragraph">
<p>Dans la plupart des cas ces deux patrons ne vont <strong>pas du tout ensemble</strong>.
Cette stratégie n&#8217;est recommandée que dans un cas bien précis d&#8217;utilisation de
<em>Strategy</em> : celle où les comportements sont simples et "statiques" (pas de
	consomation de ressources par exemple) et où l&#8217;on utilise une association :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/strategy-assoc.png" alt="strategy assoc">
</div>
</div>
<div class="paragraph">
<p>Avec une implémentation du type :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">...</span>
<span class="tok-n">vol</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">VolerAvecDesAiles</span><span class="tok-o">();</span>
<span class="tok-n">cri</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Cancan</span><span class="tok-o">();</span>
<span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Colvert</span><span class="tok-o">(</span><span class="tok-n">vol</span><span class="tok-o">,</span><span class="tok-n">cri</span><span class="tok-o">);</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_et_si_on_améliorait_le_jeu_d_aventure_avec_singleton"><a class="link" href="#_et_si_on_améliorait_le_jeu_d_aventure_avec_singleton">2.1. Et si on améliorait le jeu d&#8217;aventure avec Singleton?</a></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Faites en sorte que les instances d&#8217;objet affectées à chaque comportement
d&#8217;un <code>Personnage</code> soient uniques pour chaque comportement distinct.</p>
</li>
<li>
<p>Pourquoi ne peut-on pas utiliser de <code>getInstance()</code> dans le cas
d&#8217;une composition ?</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/solution.png" alt="Important">
</td>
<td class="content">
<div class="title">Solution</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extrait de solution (disponible sur le GitHub pour les profs)</p>
<div class="listingblock">
<div class="title">Extrait de ComportemenEpee.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ComportementEpee</span> <span class="tok-kd">implements</span> <span class="tok-n">ComportementArme</span> <span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">ComportementEpee</span> <span class="tok-n">uniqueInstance</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ComportementEpee</span><span class="tok-o">();</span>

	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ComportementEpee</span> <span class="tok-nf">getInstance</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">uniqueInstance</span><span class="tok-o">;</span>
	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Extrait de Chevalier.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Chevalier</span> <span class="tok-kd">extends</span> <span class="tok-n">Personnage</span> <span class="tok-o">{</span>

	<span class="tok-kd">protected</span> <span class="tok-nf">Chevalier</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nom</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">this</span><span class="tok-o">(</span><span class="tok-n">nom</span><span class="tok-o">,</span> <span class="tok-n">ComportementEpee</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">(),</span> <span class="tok-n">ComportementACheval</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">());</span>
	<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Car dans une composition les objets possèdent les instances de leur
comportement. Elles sont donc uniques.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_problème_du_main_de_test_du_jeu_d_aventure"><a class="link" href="#_problème_du_main_de_test_du_jeu_d_aventure">2.2. Problème du main de test du jeu d&#8217;aventure</a></h3>
<div class="paragraph">
<p>Vous avez sûrement dans votre <code>main</code> du code de jeu une partie du code
du style :</p>
</div>
<div class="listingblock">
<div class="title">Adaptation des comportements à la situation</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">choix</span> <span class="tok-o">==</span> <span class="tok-s">&quot;Epee&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">perso</span><span class="tok-o">.</span><span class="tok-na">setArme</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">ComportementEpee</span><span class="tok-o">());</span>
		<span class="tok-o">}</span>
		<span class="tok-k">else</span> <span class="tok-nf">if</span> <span class="tok-o">(</span><span class="tok-n">choix</span> <span class="tok-o">==</span> <span class="tok-s">&quot;Arc&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">perso</span><span class="tok-o">.</span><span class="tok-na">setArme</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">ComportementArc</span><span class="tok-o">());</span>
		<span class="tok-k">else</span> <span class="tok-k">if</span> <span class="tok-o">...</span>
			<span class="tok-o">...</span>
		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ce code est peu adaptatif et va soufrir des évolutions, par exemple :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>changement de la liste des armes possibles</p>
</li>
<li>
<p>rajouter des <code>if then else</code> à chaque nouvelle arme</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Isoler ce code dans une classe <code>SimpleFabriqueArme</code> qui possèdera
une méthode <code>creerComportementArme(String type)</code> qui retourne le comportement
adapté.</p>
</li>
<li>
<p>Donnez le schéma <a href="http://www.uml.org/">UML&#8482;</a> de la nouvelle organisation.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/solution.png" alt="Important">
</td>
<td class="content">
<div class="title">Solution</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implémentation</p>
<div class="listingblock">
<div class="title">Extrait de FabriqueArme.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SimpleFabriqueArme</span> <span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-n">ComportementArme</span> <span class="tok-nf">creerComportementArme</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">type</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">ComportementArme</span> <span class="tok-n">cpt</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">type</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;Epee&quot;</span><span class="tok-o">))</span> <span class="tok-o">{</span>
			<span class="tok-n">cpt</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ComportementEpee</span><span class="tok-o">();</span>
		<span class="tok-o">}</span>
		<span class="tok-k">else</span> <span class="tok-nf">if</span> <span class="tok-o">(</span><span class="tok-n">type</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;Arc&quot;</span><span class="tok-o">))</span> <span class="tok-o">{</span>
			<span class="tok-n">cpt</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ComportementArc</span><span class="tok-o">();</span>
		<span class="tok-o">}</span>
		<span class="tok-k">return</span> <span class="tok-n">cpt</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Modèle de la fabrique de comportements d&#8217;armes</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/fabriqueArme.png" alt="fabriqueArme">
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_le_patron_fabrique"><a class="link" href="#_le_patron_fabrique">3. Le patron Fabrique</a></h2>
<div class="sectionbody">
<div id="Fabrique" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/pattern.jpeg" alt="Note">
</td>
<td class="content">
<div class="title">Design pattern : <strong>Fabrique</strong></div>
<div class="paragraph">
<p><strong>Fabrique</strong> (simple) définit une interface pour la création d&#8217;un objet, mais en laissant
à des sous-classes le choix des classes à instancier (voir aussi <a href="#FabriqueAbstraite">Fabrique abstraite</a>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/fabrique.svg" alt="fabrique">
</div>
<div class="title">Figure 1. Modèle UML du patron Fabrique</div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/google-fabrique.png"><img src="images/google-fabrique.png" alt="google fabrique"></a>
</div>
<div class="title">Figure 2. Quelques exemples de description du patron Fabrique</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pour_aller_plus_loin"><a class="link" href="#_pour_aller_plus_loin">Pour aller plus loin</a></h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Comment testeriez-vous la mise en oeuvre du patron <a href="#Fabrique">Fabrique</a>?</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_about"><a class="link" href="#_about">About&#8230;&#8203;</a></h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Document réalisé par <a href="mailto:{email}">Dut/Info-S3/M3105</a> via  <a href="http://asciidoctor.org/">Asciidoctor</a> (version <code>1.5.1</code>) de 'Dan Allen', lui même basé sur <a href="http://www.methods.co.nz/asciidoc">AsciiDoc</a>.
Pour l&#8217;instant ce document est libre d&#8217;utilisation et géré par la 'Licence Creative Commons'.
<span class="image"><a class="image" href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="images/88x31.png" alt="Licence Creative Commons"></a></span>
<a href="http://creativecommons.org/licenses/by-sa/3.0/">licence Creative Commons Paternité - Partage à l&#39;Identique 3.0 non transposé</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-11-19 23:53:00 CET
</div>
</div>
</body>
</html>