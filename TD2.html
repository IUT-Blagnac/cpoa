<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.1">
<meta name="author" content="Dut/Info-S3/M3105">
<meta name="copyright" content="{date=2014-11-20}, IUT Blagnac *** Dut/Info-S3/M3105 *** Powered by AsciiDoc and W3C Slidy &amp;#169;">
<title>CPOA - Support TD 2</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="./pygments-default.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>CPOA - Support TD 2</h1>
<div class="details">
<span id="author" class="author">Dut/Info-S3/M3105</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_rappel_du_cours">1. Rappel du cours</a></li>
<li><a href="#_la_fabrique_de_chocolat">2. La fabrique de chocolat</a>
<ul class="sectlevel2">
<li><a href="#_problème_initial">2.1. Problème initial</a></li>
<li><a href="#_amélioration_1">2.2. Amélioration 1</a></li>
<li><a href="#_amélioration_2">2.3. Amélioration 2</a></li>
<li><a href="#_c_est_pas_fini">2.4. C&#8217;est pas fini!</a></li>
<li><a href="#_solution_au_multithreading">2.5. Solution au multithreading</a></li>
<li><a href="#_problème_de_la_solution">2.6. Problème de la solution!!</a></li>
</ul>
</li>
<li><a href="#_le_patron_singleton">3. Le patron Singleton</a></li>
<li><a href="#_le_singleton_pour_le_jeu_d_aventure">4. Le singleton pour le jeu d&#8217;aventure</a>
<ul class="sectlevel2">
<li><a href="#_combiner_plusieurs_patrons">4.1. Combiner plusieurs patrons?</a></li>
<li><a href="#_et_si_on_améliorait_le_jeu_d_aventure_avec_singleton">4.2. Et si on améliorait le jeu d&#8217;aventure avec Singleton?</a></li>
</ul>
</li>
<li><a href="#_pour_aller_plus_loin">Pour aller plus loin</a></li>
<li><a href="#_about">About&#8230;&#8203;</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<img src="images/icons/caution.png" alt="Caution">
</td>
<td class="content">
<div class="title">Version corrigée</div>
<div class="paragraph">
<p>Cette version comporte des indications pour les
réponses aux exercices.</p>
</div>
</td>
</tr>
</table>
</div>
<table id="cartouche" class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 9%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PreReq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1. Je sais programmer en <a href="https://www.java.com/fr/">Java</a>.
2. J&#8217;ai conscience qu&#8217;il faut réfléchir avant de se lancer dans le codage.
3. Je maîtrise les concepts objet de base (héritage, polymorphisme, &#8230;&#8203;).
4. J&#8217;ai compris ce qu&#8217;est un patron et j&#8217;ai grand soif d&#8217;en apprendre d&#8217;autres que
<em>Strategy</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ObjTD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aborder le patron <strong>singleton</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Durée</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong> TD et <strong>2</strong> TP de 1,5h (sur 2 semaines).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_rappel_du_cours"><a class="link" href="#_rappel_du_cours">1. Rappel du cours</a></h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="images/icons/tip.png" alt="Tip">
</td>
<td class="content">
N&#8217;hésitez pas à (re)lire régulièrement le <a href="http://iut-blagnac.github.io/cpoa/">Support de Cours</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_la_fabrique_de_chocolat"><a class="link" href="#_la_fabrique_de_chocolat">2. La fabrique de chocolat</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vous participez au développement d&#8217;un simulateur de fabriques
de chocolat modernes dont des bouilleurs sont assistés par ordinateur.</p>
</div>
<div class="paragraph">
<p>La tâche du bouilleur consiste à contenir un mélange de chocolat et de lait,
à le porter à ébullition puis à le transmettre à la phase suivante où il est
transformé en plaquettes de chocolat.</p>
</div>
<div class="sect2">
<h3 id="_problème_initial"><a class="link" href="#_problème_initial">2.1. Problème initial</a></h3>
<div class="paragraph">
<p>Voici la classe contrôleur du bouilleur industriel de <em>Bonchoco, SA</em>.</p>
</div>
<div class="listingblock">
<div class="title">Contrôleur du bouilleur en Java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-cm">/**</span>
<span class="tok-cm"> * @author bruel (taken from Design Pattren - Head First, O&#39;Reilly, 09/2004)</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BouilleurChocolat</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">vide</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">bouilli</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">BouilleurChocolat</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">vide</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
		<span class="tok-n">bouilli</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">remplir</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">estVide</span><span class="tok-o">())</span> <span class="tok-o">{</span>
			<span class="tok-n">vide</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
			<span class="tok-n">bouilli</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
			<span class="tok-c1">// remplir le bouilleur du mélange lait/chocolat</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">vider</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">estVide</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">estBouilli</span><span class="tok-o">())</span> <span class="tok-o">{</span>
			<span class="tok-c1">// vider le mélange</span>
			<span class="tok-n">vide</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">bouillir</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">estVide</span><span class="tok-o">()</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-o">!</span><span class="tok-n">estBouilli</span><span class="tok-o">())</span> <span class="tok-o">{</span>
			<span class="tok-c1">// porter le contenu à ébullition</span>
			<span class="tok-n">bouilli</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">estVide</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">vide</span><span class="tok-o">;}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">estBouilli</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">bouilli</span><span class="tok-o">;}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>À quoi servent les attributs <code>vide</code> et <code>bouilli</code>?</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/solution.png" alt="Important">
</td>
<td class="content">
<div class="title">Solution</div>
<div class="paragraph">
<p>Si vous étudiez le code, vous constatez qu&#8217;ils ont essayé très soigneusement d&#8217;éviter
les catastrophes, par exemple de vider deux mille litres de mélange qui n&#8217;a pas bouilli,
de remplir un bouilleur déjà plein ou de faire bouillir un bouilleur vide !</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Vous faîtes un cauchemar horrible (quoi que) où vous vous noyez dans du chocolat.
Vous vous réveillez en sursaut avec une crainte terrible.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Que pourrait-il se passer avec plusieurs instances de contrôleurs?</p>
</li>
<li>
<p>De quoi faudrait-il s&#8217;assurer pour éviter ce problème?</p>
</li>
<li>
<p>Trouvez des exemples de situations où il est important de n&#8217;avoir
qu&#8217;une seule instance d&#8217;une classe donnée?</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/solution.png" alt="Important">
</td>
<td class="content">
<div class="title">Solution</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Que l&#8217;un remplisse alors que l&#8217;autre n&#8217;a pas vidé par exemple.</p>
</li>
<li>
<p>S&#8217;assurer de n&#8217;avoir qu&#8217;une seule instance de ce contrôleur.</p>
</li>
<li>
<p>Quelques exemples :</p>
<div class="ulist">
<ul>
<li>
<p>accès unique à une base de données (on vient de le voir)</p>
</li>
<li>
<p>objet "parent" d&#8217;une interface</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_amélioration_1"><a class="link" href="#_amélioration_1">2.2. Amélioration 1</a></h3>
<div class="paragraph">
<p>Vous vous souvenez des premiers exercices <a href="https://www.java.com/fr/">Java</a>  sur les variables de classe
et vous proposez d&#8217;utiliser un compteur d&#8217;instance pour solutionner le problème.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="paragraph">
<p>Vous essayez de modifier le constructeur pour qu&#8217;il ne fonctionne que si le compteur d&#8217;instance est à 0.
Qu&#8217;est-ce qui ne va pas dans le code suivant :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BouilleurCptChocolat</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">vide</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">bouilli</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kt">int</span> <span class="tok-n">nbInstance</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>

	<span class="tok-kd">private</span> <span class="tok-nf">BouilleurCptChocolat</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">vide</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
		<span class="tok-n">bouilli</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">nbInstance</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">nbInstance</span> <span class="tok-o">=</span> <span class="tok-mi">1</span><span class="tok-o">;</span>
			<span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>
		<span class="tok-k">else</span> <span class="tok-o">{</span>
			<span class="tok-k">return</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
		<span class="tok-o">}</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/solution.png" alt="Important">
</td>
<td class="content">
<div class="title">Solution</div>
<div class="paragraph">
<p>Pas de return dans un constructeur.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_amélioration_2"><a class="link" href="#_amélioration_2">2.3. Amélioration 2</a></h3>
<div class="paragraph">
<p>Vous changez de stratégie car vous vous souvenez avoir déjà vu ce type de code :</p>
</div>
<div class="listingblock">
<div class="title">Idée!</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-err">￼</span><span class="tok-kd">public</span> <span class="tok-n">MaClasse</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-nf">MaClasse</span><span class="tok-o">()</span> <span class="tok-o">{...}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Est-ce autorisé de rendre privé le constructeur?</p>
</li>
<li>
<p>Comment créer une instance dans ces conditions? N&#8217;a-t&#8217;on pas tout simplement une classe inutilisable?</p>
</li>
<li>
<p>Complétez le code suivant de façon à résoudre le problème :</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BouilleurChocolat</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">vide</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">bouilli</span><span class="tok-o">;</span>
	<span class="tok-o">...</span>
	<span class="tok-o">...</span>

	        <span class="tok-n">BouilleurChocolat</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-o">...</span>
		<span class="tok-o">...</span>
		<span class="tok-o">}</span>

	<span class="tok-o">...</span>
	<span class="tok-o">...</span>
	<span class="tok-o">...</span>
	<span class="tok-o">...</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">remplir</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">estVide</span><span class="tok-o">())</span> <span class="tok-o">{</span>
			<span class="tok-n">vide</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
			<span class="tok-n">bouilli</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
			<span class="tok-c1">// remplir le bouilleur du mélange lait/chocolat }</span>
		<span class="tok-o">}</span>
		<span class="tok-c1">// reste du code de BouilleurChocolat...</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Donnez un exemple d&#8217;utilisation de cette classe.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/solution.png" alt="Important">
</td>
<td class="content">
<div class="title">Solution</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Oui!</p>
</li>
<li>
<p>En implémentant une fonction qui s&#8217;en charge.</p>
<div class="listingblock">
<div class="title">Extrait de la solution</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BouilleurSafeChocolat</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">vide</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">bouilli</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">BouilleurSafeChocolat</span> <span class="tok-n">uniqueInstance</span><span class="tok-o">;</span>

	<span class="tok-kd">private</span> <span class="tok-nf">BouilleurSafeChocolat</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">vide</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
		<span class="tok-n">bouilli</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">BouilleurSafeChocolat</span> <span class="tok-nf">getInstance</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">uniqueInstance</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-n">uniqueInstance</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">BouilleurSafeChocolat</span><span class="tok-o">();</span>
		<span class="tok-o">}</span>
		<span class="tok-k">return</span> <span class="tok-n">uniqueInstance</span><span class="tok-o">;</span>
	<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_c_est_pas_fini"><a class="link" href="#_c_est_pas_fini">2.4. C&#8217;est pas fini!</a></h3>
<div class="paragraph">
<p>Vos cauchemars continuent! Mais cette fois ils sont en anglais! Vous voyez un
grand gaillard irlandais vous menacez (en fait vous confondez <em>threat</em> et <em>thread</em>&#8230;&#8203;).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>En quoi les <em>threads</em> peuvent-ils poser des problèmes dans votre solution?</p>
</li>
<li>
<p>Recopiez sur des bouts de feuilles les fragments de code ci-dessous en les plaçant dans les
colonnes du tableau suivant :</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Thread 1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Thread 2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Valeur de <code>uniqueInstance</code></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Bloc 1</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">BouilleurChocolat</span> <span class="tok-nf">getInstance</span><span class="tok-o">()</span> <span class="tok-o">{</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bloc 2</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">uniqueInstance</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bloc 3</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-n">uniqueInstance</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">BouilleurSafeChocolat</span><span class="tok-o">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bloc 4</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">		<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bloc 5</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">		<span class="tok-k">return</span> <span class="tok-n">uniqueInstance</span><span class="tok-o">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Bloc 6</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/thread-sol.png" alt="IMPORTANT">
</div>
<div class="title">Figure 1. Solution</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_au_multithreading"><a class="link" href="#_solution_au_multithreading">2.5. Solution au multithreading</a></h3>
<div class="paragraph">
<p>Vous vous souvenez heureusement de vos cours de début d&#8217;année sur les <em>threads</em> :</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Proposez une solution simple à ce problème.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/solution.png" alt="Important">
</td>
<td class="content">
<div class="title">Solution</div>
<div class="paragraph">
<p>Il suffit de faire de <code>getInstance()`</code> une méthode synchronisée :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">synchronized</span> <span class="tok-n">Singleton</span> <span class="tok-nf">getInstance</span><span class="tok-o">()</span> <span class="tok-o">{</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_problème_de_la_solution"><a class="link" href="#_problème_de_la_solution">2.6. Problème de la solution!!</a></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Combien de fois la synchronisation va-t&#8217;elle être utile ?</p>
</li>
<li>
<p>Que pensez-vous alors de cette solution ?</p>
</li>
<li>
<p>Proposez une solution où l&#8217;instance est créé au démarrage plutôt qu&#8217;à la demande.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/solution.png" alt="Important">
</td>
<td class="content">
<div class="title">Solution</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Une seule fois, lors du 1er passage dans la méthode!!</p>
</li>
<li>
<p>C&#8217;est bien trop consomateur en ressource!</p>
</li>
<li>
<p>Voici un exemple :</p>
<div class="listingblock">
<div class="title">Création de l&#8217;instance unique au démarrage</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Singleton</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">Singleton</span> <span class="tok-n">uniqueInstance</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Singleton</span><span class="tok-o">();</span>
	<span class="tok-kd">private</span> <span class="tok-nf">Singleton</span><span class="tok-o">()</span> <span class="tok-o">{}</span>
	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">Singleton</span> <span class="tok-nf">getInstance</span><span class="tok-o">()</span> <span class="tok-o">{</span> <span class="tok-k">return</span> <span class="tok-n">uniqueInstance</span><span class="tok-o">;}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En adoptant cette approche, nous nous reposons sur la JVM pour créer
l&#8217;unique instance du Singleton quand la classe est chargée.
La JVM garantit que l&#8217;instance sera créée avant qu&#8217;un thread
quelconque n&#8217;accède à la variable statique <code>uniqueInstance</code>.</p>
</div>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
Il peut y avoir des situations où le coût de la synchronisation est inférieur au coût de
créer dès le départ une instance (par exemple gourmande en mémoire).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_le_patron_singleton"><a class="link" href="#_le_patron_singleton">3. Le patron Singleton</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Félicitations, vous venez de mettre en oeuvre votre deuxième patron, le <strong>Singleton</strong>.</p>
</div>
<div id="Singleton" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/pattern.jpeg" alt="Note">
</td>
<td class="content">
<div class="title">Design pattern : <strong>Singleton</strong></div>
<div class="paragraph">
<p><strong>Singleton</strong> garantit qu&#8217;une classe n&#8217;a qu&#8217;une seule instance et
fournit un point d&#8217;accès global à cette instance.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/singleton.png" alt="singleton">
</div>
<div class="title">Figure 2. Modèle UML du patron <em>Singleton</em></div>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/google-singleton.png"><img src="images/google-singleton.png" alt="google singleton"></a>
</div>
<div class="title">Figure 3. Quelques exemples de description du patron Singleton</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_le_singleton_pour_le_jeu_d_aventure"><a class="link" href="#_le_singleton_pour_le_jeu_d_aventure">4. Le singleton pour le jeu d&#8217;aventure</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_combiner_plusieurs_patrons"><a class="link" href="#_combiner_plusieurs_patrons">4.1. Combiner plusieurs patrons?</a></h3>
<div class="paragraph">
<p>Peut-on combiner les deux derniers patrons vus en TD (<em>Strategy</em> et Singleton)?
En effet, les comportements sont portés par des objets pour l&#8217;aspect algorithme,
mais il n&#8217;y a pas de raison de ne pas les partagés entre tous les objets qui
"utilisent" ce comportement?!</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
<div class="paragraph">
<p>Dans la plupart des cas ces deux patrons ne vont <strong>pas du tout ensemble</strong>.
Cette stratégie n&#8217;est recommandée que dans un cas bien précis d&#8217;utilisation de
<em>Strategy</em> : celle où les comportements sont simples et "statiques" (pas de
	consomation de ressources par exemple) et où l&#8217;on utilise une association :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/strategy-assoc.png" alt="strategy assoc">
</div>
</div>
<div class="paragraph">
<p>Avec une implémentation du type :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-o">...</span>
<span class="tok-n">vol</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">VolerAvecDesAiles</span><span class="tok-o">();</span>
<span class="tok-n">cri</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Cancan</span><span class="tok-o">();</span>
<span class="tok-n">c1</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">Colvert</span><span class="tok-o">(</span><span class="tok-n">vol</span><span class="tok-o">,</span><span class="tok-n">cri</span><span class="tok-o">);</span>
<span class="tok-o">...</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_et_si_on_améliorait_le_jeu_d_aventure_avec_singleton"><a class="link" href="#_et_si_on_améliorait_le_jeu_d_aventure_avec_singleton">4.2. Et si on améliorait le jeu d&#8217;aventure avec Singleton?</a></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Faites en sorte que les instances d&#8217;objet affectées à chaque comportement
d&#8217;un <code>Personnage</code> soient uniques pour chaque comportement distinct.</p>
</li>
<li>
<p>Pourquoi ne peut-on pas utiliser de <code>getInstance()</code> dans le cas
d&#8217;une composition ?</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/solution.png" alt="Important">
</td>
<td class="content">
<div class="title">Solution</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extrait de solution (disponible sur le GitHub pour les profs)</p>
<div class="listingblock">
<div class="title">Extrait de ComportemenEpee.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ComportementEpee</span> <span class="tok-kd">implements</span> <span class="tok-n">ComportementArme</span> <span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">ComportementEpee</span> <span class="tok-n">uniqueInstance</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ComportementEpee</span><span class="tok-o">();</span>

	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">ComportementEpee</span> <span class="tok-nf">getInstance</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">uniqueInstance</span><span class="tok-o">;</span>
	<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Extrait de Chevalier.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Chevalier</span> <span class="tok-kd">extends</span> <span class="tok-n">Personnage</span> <span class="tok-o">{</span>

	<span class="tok-kd">protected</span> <span class="tok-nf">Chevalier</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">nom</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">this</span><span class="tok-o">(</span><span class="tok-n">nom</span><span class="tok-o">,</span> <span class="tok-n">ComportementEpee</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">(),</span> <span class="tok-n">ComportementACheval</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">());</span>
	<span class="tok-o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Car dans une composition les objets possèdent les instances de leur
comportement. Elles sont donc uniques.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
On voit que ce n&#8217;est pas toujours évident de combiner les patrons entre eux.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pour_aller_plus_loin"><a class="link" href="#_pour_aller_plus_loin">Pour aller plus loin</a></h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="paragraph">
<p>Quelle est la différence entre un singleton et une variable globale?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/solution.png" alt="Important">
</td>
<td class="content">
<div class="title">Solution</div>
<div class="paragraph">
<p>Quelques éléments de solution :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>En <a href="https://www.java.com/fr/">Java</a> les variables globales sont des références statiques à des objets.</p>
</li>
<li>
<p>Problème déjà vu de l&#8217;instanciation à la demande vs. au démarrage.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>Mots-croisés</strong></div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/crossword2.png"><img src="images/crossword1.png" alt="crossword1"></a>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/solution.png" alt="Important">
</td>
<td class="content">
<div class="title">Solution</div>
<div class="imageblock">
<div class="content">
<a class="image" href="images/crossword2-sol.png"><img src="images/crossword2-sol.png" alt="crossword2 sol"></a>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Comment testeriez-vous la mise en oeuvre du patron <a href="#Singleton">Singleton</a>?</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="paragraph">
<p>Il existe une autre façon de gérer le problème du multithreading. Cherchez sur Internet
les articles sur le "verrouillage à double vérification" (qui ne fonctionne que depuis
	Java <code>1.5</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="images/icons/tip.png" alt="Tip">
</td>
<td class="content">
N&#8217;hésitez pas à consulter
<a href="http://thecodersbreakfast.net/index.php?post/2008/02/25/26-de-la-bonne-implementation-du-singleton-en-java">le site dont je me suis inspiré</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_about"><a class="link" href="#_about">About&#8230;&#8203;</a></h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Document réalisé par <a href="mailto:{email}">Dut/Info-S3/M3105</a> via  <a href="http://asciidoctor.org/">Asciidoctor</a> (version <code>1.5.1</code>) de 'Dan Allen', lui même basé sur <a href="http://www.methods.co.nz/asciidoc">AsciiDoc</a>.
Pour l&#8217;instant ce document est libre d&#8217;utilisation et géré par la 'Licence Creative Commons'.
<span class="image"><a class="image" href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="images/88x31.png" alt="Licence Creative Commons"></a></span>
<a href="http://creativecommons.org/licenses/by-sa/3.0/">licence Creative Commons Paternité - Partage à l&#39;Identique 3.0 non transposé</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-11-20 00:20:56 CET
</div>
</div>
</body>
</html>