<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Dut/Info-S3/M3105 - Semaine 5 (51)">
<meta name="copyright" content="{date=2014-12-14}, IUT Blagnac *** Dut/Info-S3/M3105 - Semaine 5 (51) *** Powered by AsciiDoc and W3C Slidy &amp;#169;">
<title>CPOA - Sujet TD 5</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="./pygments-manni.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>CPOA - Sujet TD 5</h1>
<div class="details">
<span id="author" class="author">Dut/Info-S3/M3105 - Semaine 5 (51)</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_rappel_du_cours">1. Rappel du cours</a></li>
<li><a href="#_motivation">2. Motivation</a></li>
<li><a href="#_the_observer_design_pattern">3. The Observer design pattern</a>
<ul class="sectlevel2">
<li><a href="#_definition_sorry_for_the_french">3.1. Definition (sorry for the French)</a></li>
<li><a href="#_intent">3.2. Intent</a></li>
<li><a href="#_applicability">3.3. Applicability</a></li>
<li><a href="#_participants">3.4. Participants</a></li>
<li><a href="#_scenario">3.5. Scenario</a></li>
<li><a href="#_benefits">3.6. Benefits</a></li>
<li><a href="#_liabilities">3.7. Liabilities</a></li>
</ul>
</li>
<li><a href="#_implementation_issues">4. Implementation Issues</a>
<ul class="sectlevel2">
<li><a href="#_problems">4.1. Problems</a></li>
<li><a href="#__em_observer_em_in_java">4.2. <em>Observer</em> in Java</a></li>
<li><a href="#_observable_observer_example">4.3. Observable/Observer Example</a></li>
<li><a href="#_limitations_of_observable_observer_in_java">4.4. Limitations of Observable/Observer in Java</a></li>
</ul>
</li>
<li><a href="#_pour_aller_plus_loin">Pour aller plus loin</a></li>
<li><a href="#_about">About&#8230;&#8203;</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<table id="cartouche" class="tableblock frame-all grid-all" style="width: 90%;">
<colgroup>
<col style="width: 9%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PreReq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1. Je sais programmer en <a href="https://www.java.com/fr/">Java</a>.
2. J&#8217;ai conscience qu&#8217;il faut réfléchir avant de se lancer dans le codage.
3. Je maîtrise quelques patrons de conception.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ObjTD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aborder le patron <strong>Observer</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Durée</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong> TD et <strong>2</strong> TPs</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_rappel_du_cours"><a class="link" href="#_rappel_du_cours">1. Rappel du cours</a></h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="images/icons/tip.png" alt="Tip">
</td>
<td class="content">
N&#8217;hésitez pas à (re)lire régulièrement le <a href="http://iut-blagnac.github.io/cpoa/">Support de Cours</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_motivation"><a class="link" href="#_motivation">2. Motivation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this exercice, we will explore the need to maintain consistency between related objects without making classes tightly coupled.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/observer-illustration.png" alt="observer illustration">
</div>
<div class="title">Figure 1. The classical Observer illustration</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_observer_design_pattern"><a class="link" href="#_the_observer_design_pattern">3. The Observer design pattern</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_definition_sorry_for_the_french"><a class="link" href="#_definition_sorry_for_the_french">3.1. Definition (sorry for the French)</a></h3>
<div class="paragraph">
<p><strong>Observateur</strong> définit une relation entre objets de type
un-à-plusieurs, de façon que, lorsqu&#8217;un objet change d&#8217;état,
tous ceux qui en dépendent en soient notifiés et soient mis à jour
automatiquement.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/observateur.svg" alt="observateur">
</div>
<div class="title">Figure 2. Modèle UML du patron <em>Observer</em></div>
</div>
<div class="paragraph">
<p>Quelques précisions :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>les observateurs doivent être enregistrés</p>
</li>
<li>
<p>le sujet est chargé de prévenir les observateurs (d&#8217;un changement).</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/observer-scenario2.png" alt="observer scenario2">
</div>
<div class="title">Figure 3. Example of use</div>
</div>
<div class="paragraph">
<p>On peut réaliser de plusieurs façon le <code>attacher</code>, mais
il doit être fait pour que ca marche :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>par un objet extérieur,</p>
</li>
<li>
<p>par le <code>concreteObserver</code> lui-même.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_intent"><a class="link" href="#_intent">3.2. Intent</a></h3>
<div class="ulist">
<ul>
<li>
<p>Define a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_applicability"><a class="link" href="#_applicability">3.3. Applicability</a></h3>
<div class="paragraph">
<p>Use the Observer pattern in any of the following situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When an abstraction has two aspects, one dependent on the other.
Encapsulating these aspects in separate objects lets you vary and reuse
them independently.</p>
</li>
<li>
<p>When a change to one object requires changing others</p>
</li>
<li>
<p>When an object should be able to notify other objects without making
assumptions about those objects</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_participants"><a class="link" href="#_participants">3.4. Participants</a></h3>
<div class="ulist">
<ul>
<li>
<p><code>Subject</code></p>
<div class="ulist">
<ul>
<li>
<p>Keeps track of its <code>observers</code></p>
</li>
<li>
<p>Provides an interface for attaching and detaching <code>Observer</code> objects</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Observer</code></p>
<div class="ulist">
<ul>
<li>
<p>Defines an interface for update notification</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ConcreteSubject</code></p>
<div class="ulist">
<ul>
<li>
<p>The object being observed</p>
</li>
<li>
<p>Stores state of interest to ConcreteObserver objects</p>
</li>
<li>
<p>Sends a notification to its observers when its state changes</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ConcreteObserver</code></p>
<div class="ulist">
<ul>
<li>
<p>The observing object</p>
</li>
<li>
<p>Stores state that should stay consistent with the subject&#8217;s</p>
</li>
<li>
<p>Implements the Observer update interface to keep its state consistent with
the subject&#8217;s</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_scenario"><a class="link" href="#_scenario">3.5. Scenario</a></h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="paragraph">
<p>Pour vérifiez que vous avez compris son utilité, réalisez
un diagramme de séquence illustrant l&#8217;utilisation du patron <em>Observer</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_benefits"><a class="link" href="#_benefits">3.6. Benefits</a></h3>
<div class="ulist">
<ul>
<li>
<p>Minimal coupling between the Subject and the Observer</p>
<div class="ulist">
<ul>
<li>
<p>Can reuse subjects without reusing their observers and vice versa</p>
</li>
<li>
<p>Observers can be added without modifying the subject</p>
</li>
<li>
<p>All subject knows is its list of observers</p>
</li>
<li>
<p>Subject does not need to know the concrete class of an observer, just that
each observer implements the update interface</p>
</li>
<li>
<p>Subject and observer can belong to different abstraction layers</p>
</li>
</ul>
</div>
</li>
<li>
<p>Support for event broadcasting</p>
<div class="ulist">
<ul>
<li>
<p>Subject sends notification to all subscribed observers</p>
</li>
<li>
<p>Observers can be added/removed at any time</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_liabilities"><a class="link" href="#_liabilities">3.7. Liabilities</a></h3>
<div class="ulist">
<ul>
<li>
<p>Possible cascading of notifications</p>
<div class="ulist">
<ul>
<li>
<p>Observers are not necessarily aware of each other and must be careful
about triggering updates</p>
</li>
</ul>
</div>
</li>
<li>
<p>Simple update interface requires observers to deduce changed item</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_issues"><a class="link" href="#_implementation_issues">4. Implementation Issues</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_problems"><a class="link" href="#_problems">4.1. Problems</a></h3>
<div class="paragraph">
<p>Let&#8217;s try to define an implementation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="images/icons/tip.png" alt="Tip">
</td>
<td class="content">
If you already know or have used the <code>Observer</code> <a href="https://www.java.com/fr/">Java</a> implementation,
try to forget it!
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="paragraph">
<p>Here are a list of possible issues. For each of them try to provide
some answers:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>How does the subject keep track of its observers?</p>
</li>
<li>
<p>What if an observer wants to observe more than one subject?</p>
</li>
<li>
<p>Who triggers the update?</p>
</li>
<li>
<p>Make sure the subject updates its state before sending out notifications</p>
</li>
<li>
<p>How much info about the change should the subject send to the observers?</p>
</li>
<li>
<p>Can the observers subscribe to specific events of interest?</p>
</li>
<li>
<p>Can an observer also be a subject?</p>
</li>
<li>
<p>What if an observer wants to be notified only after several subjects have
changed state?</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="__em_observer_em_in_java"><a class="link" href="#__em_observer_em_in_java">4.2. <em>Observer</em> in Java</a></h3>
<div class="paragraph">
<p><a href="https://www.java.com/fr/">Java</a> provides the <em>Observable/Observer</em> classes as built-in
support for the <em>Observer</em> pattern.
The <code>java.util.Observable</code> class is the base <code>Subject</code> class.
Any class that wants to be observed extends this class which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provides methods to add/delete observers</p>
</li>
<li>
<p>Provides methods to notify all observers</p>
</li>
<li>
<p>A subclass only needs to ensure that its observers are notified in the
appropriate mutators</p>
</li>
<li>
<p>Uses a <code>Vector</code> for storing the observer references</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>java.util.Observer</code> interface is the <code>Observer</code> interface.
It must be implemented by any observer class.</p>
</div>
<div class="sect3">
<h4 id="_the_java_util_observable_class"><a class="link" href="#_the_java_util_observable_class">4.2.1. The java.util.Observable Class</a></h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="paragraph">
<p>Here is a list of methods of the <code>java.util.Observable</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="lineno">1</span> <span class="tok-kd">public</span> <span class="tok-nf">Observable</span><span class="tok-o">()</span>
<span class="lineno">2</span> <span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">addObserver</span><span class="tok-o">(</span><span class="tok-n">Observer</span> <span class="tok-n">o</span><span class="tok-o">)</span>
<span class="lineno">3</span> <span class="tok-kd">protected</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">setChanged</span><span class="tok-o">()</span>
<span class="lineno">4</span> <span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">deleteObserver</span><span class="tok-o">(</span><span class="tok-n">Observer</span> <span class="tok-n">o</span><span class="tok-o">)</span>
<span class="lineno">5</span> <span class="tok-kd">protected</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">void</span> <span class="tok-nf">clearChanged</span><span class="tok-o">()</span>
<span class="lineno">6</span> <span class="tok-kd">public</span> <span class="tok-kd">synchronized</span> <span class="tok-kt">boolean</span> <span class="tok-nf">hasChanged</span><span class="tok-o">()</span>
<span class="lineno">7</span> <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notifyObservers</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">arg</span><span class="tok-o">)</span>
<span class="lineno">8</span> <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notifyObservers</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Match them with their corresponding comments:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adds an observer to the set of observers of this object</p>
</li>
<li>
<p>If this object has changed, as indicated by the hasChanged() method, then
notify all of its observers and then call the clearChanged() method to
indicate that this object has no longer changed. Each observer has its
update() method called with two arguments: this observable object and the
arg argument. The arg argument can be used to indicate which attribute of
the observable object has changed.</p>
</li>
<li>
<p>Indicates that this object has changed</p>
</li>
<li>
<p>Indicates that this object has no longer changed, or that it has already
notified all of its observers of its most recent change. This method is called
automatically by <code>notifyObservers()</code>.</p>
</li>
<li>
<p>Same as above, but the arg argument is set to null. That is, the observer is
given no indication what attribute of the observable object has changed.</p>
</li>
<li>
<p>Tests if this object has changed. Returns true if setChanged() has been
called more recently than clearChanged() on this object; false otherwise.</p>
</li>
<li>
<p>Construct an <code>Observable</code> with zero observers</p>
</li>
<li>
<p>Deletes an observer from the set of observers of this object</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_the_java_util_observer_interface"><a class="link" href="#_the_java_util_observer_interface">4.2.2. The java.util.Observer Interface</a></h4>
<div class="listingblock">
<div class="title">java.util.Observer</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="lineno"> 1</span> <span class="tok-cm">/**</span>
<span class="lineno"> 2</span> <span class="tok-cm">* This method is called whenever the observed object is changed. An</span>
<span class="lineno"> 3</span> <span class="tok-cm">* application calls an observable object&#39;s notifyObservers method to have all</span>
<span class="lineno"> 4</span> <span class="tok-cm">* the object&#39;s observers notified of the change.</span>
<span class="lineno"> 5</span> <span class="tok-cm">*</span>
<span class="lineno"> 6</span> <span class="tok-cm">* Parameters:</span>
<span class="lineno"> 7</span> <span class="tok-cm">* o - the observable object</span>
<span class="lineno"> 8</span> <span class="tok-cm">* arg - an argument passed to the notifyObservers method</span>
<span class="lineno"> 9</span> <span class="tok-cm">*/</span>
<span class="lineno">10</span> <span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-kt">void</span> <span class="tok-nf">update</span><span class="tok-o">(</span><span class="tok-n">Observable</span> <span class="tok-n">o</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">arg</span><span class="tok-o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_observable_observer_example"><a class="link" href="#_observable_observer_example">4.3. Observable/Observer Example</a></h3>
<div class="listingblock">
<div class="title">ConcreteSubject.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="lineno"> 1</span> <span class="tok-cm">/**</span>
<span class="lineno"> 2</span> <span class="tok-cm">* A subject to observe!</span>
<span class="lineno"> 3</span> <span class="tok-cm">*/</span>
<span class="lineno"> 4</span> <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ConcreteSubject</span> <span class="tok-kd">extends</span> <span class="tok-n">Observable</span> <span class="tok-o">{</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span>   <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno"> 7</span>   <span class="tok-kd">private</span> <span class="tok-kt">float</span> <span class="tok-n">price</span><span class="tok-o">;</span>
<span class="lineno"> 8</span>   <span class="tok-kd">public</span> <span class="tok-nf">ConcreteSubject</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-kt">float</span> <span class="tok-n">price</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9</span>     <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno">10</span>     <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">price</span> <span class="tok-o">=</span> <span class="tok-n">price</span><span class="tok-o">;</span>
<span class="lineno">11</span>     <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;ConcreteSubject created: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">name</span> <span class="tok-o">+</span> <span class="tok-s">&quot; at &quot;</span> <span class="tok-o">+</span> <span class="tok-n">price</span><span class="tok-o">);</span>
<span class="lineno">12</span>   <span class="tok-o">}</span>
<span class="lineno">13</span>   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span><span class="tok-k">return</span> <span class="tok-n">name</span><span class="tok-o">;}</span>
<span class="lineno">14</span>   <span class="tok-kd">public</span> <span class="tok-kt">float</span> <span class="tok-nf">getPrice</span><span class="tok-o">()</span> <span class="tok-o">{</span><span class="tok-k">return</span> <span class="tok-n">price</span><span class="tok-o">;}</span>
<span class="lineno">15</span>   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setName</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">16</span>     <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno">17</span>     <span class="tok-n">setChanged</span><span class="tok-o">();</span>
<span class="lineno">18</span>     <span class="tok-n">notifyObservers</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">);</span>
<span class="lineno">19</span>   <span class="tok-o">}</span>
<span class="lineno">20</span>   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setPrice</span><span class="tok-o">(</span><span class="tok-kt">float</span> <span class="tok-n">price</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">21</span>     <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">price</span> <span class="tok-o">=</span> <span class="tok-n">price</span><span class="tok-o">;</span>
<span class="lineno">22</span>     <span class="tok-n">setChanged</span><span class="tok-o">();</span>
<span class="lineno">23</span>     <span class="tok-n">notifyObservers</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-nf">Float</span><span class="tok-o">(</span><span class="tok-n">price</span><span class="tok-o">));</span>
<span class="lineno">24</span>   <span class="tok-o">}</span>
<span class="lineno">25</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">NameObserver.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="lineno"> 1</span> <span class="tok-c1">// An observer of name changes.</span>
<span class="lineno"> 2</span> <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">NameObserver</span> <span class="tok-kd">implements</span> <span class="tok-n">Observer</span> <span class="tok-o">{</span>
<span class="lineno"> 3</span>   <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="lineno"> 4</span>   <span class="tok-kd">public</span> <span class="tok-nf">NameObserver</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 5</span>     <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="lineno"> 6</span>     <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;NameObserver created: Name is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">name</span><span class="tok-o">);</span>
<span class="lineno"> 7</span>   <span class="tok-o">}</span>
<span class="lineno"> 8</span>   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">update</span><span class="tok-o">(</span><span class="tok-n">Observable</span> <span class="tok-n">obj</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">arg</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9</span>     <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">arg</span> <span class="tok-k">instanceof</span> <span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10</span>       <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span><span class="tok-n">arg</span><span class="tok-o">;</span>
<span class="lineno">11</span>       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;NameObserver: Name changed to &quot;</span> <span class="tok-o">+</span> <span class="tok-n">name</span><span class="tok-o">);</span>
<span class="lineno">12</span>     <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">13</span>       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;NameObserver: Some other change to</span>
<span class="lineno">14</span> <span class="tok-s">      subject!&quot;</span><span class="tok-o">);</span>
<span class="lineno">15</span>     <span class="tok-o">}</span>
<span class="lineno">16</span>   <span class="tok-o">}</span>
<span class="lineno">17</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">PriceObserver.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="lineno"> 1</span> <span class="tok-c1">// An observer of price changes.</span>
<span class="lineno"> 2</span> <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PriceObserver</span> <span class="tok-kd">implements</span> <span class="tok-n">Observer</span> <span class="tok-o">{</span>
<span class="lineno"> 3</span>   <span class="tok-kd">private</span> <span class="tok-kt">float</span> <span class="tok-n">price</span><span class="tok-o">;</span>
<span class="lineno"> 4</span>   <span class="tok-kd">public</span> <span class="tok-nf">PriceObserver</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno"> 5</span>     <span class="tok-n">price</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>
<span class="lineno"> 6</span>     <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;PriceObserver created: Price is &quot;</span> <span class="tok-o">+</span> <span class="tok-n">price</span><span class="tok-o">);</span>
<span class="lineno"> 7</span>   <span class="tok-o">}</span>
<span class="lineno"> 8</span>   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">update</span><span class="tok-o">(</span><span class="tok-n">Observable</span> <span class="tok-n">obj</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">arg</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno"> 9</span>     <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">arg</span> <span class="tok-k">instanceof</span> <span class="tok-n">Float</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">10</span>       <span class="tok-n">price</span> <span class="tok-o">=</span> <span class="tok-o">((</span><span class="tok-n">Float</span><span class="tok-o">)</span><span class="tok-n">arg</span><span class="tok-o">).</span><span class="tok-na">floatValue</span><span class="tok-o">();</span>
<span class="lineno">11</span>       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;PriceObserver: Price changed to &quot;</span> <span class="tok-o">+</span>
<span class="lineno">12</span>       <span class="tok-n">price</span><span class="tok-o">);</span>
<span class="lineno">13</span>     <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
<span class="lineno">14</span>       <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-err">”</span><span class="tok-nl">PriceObserver:</span> <span class="tok-n">Some</span> <span class="tok-n">other</span> <span class="tok-n">change</span> <span class="tok-n">to</span>
<span class="lineno">15</span>       <span class="tok-n">subject</span><span class="tok-o">!</span><span class="tok-err">&quot;</span><span class="tok-o">);</span>
<span class="lineno">16</span>     <span class="tok-o">}</span>
<span class="lineno">17</span>   <span class="tok-o">}</span>
<span class="lineno">18</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">TestObservers.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="lineno"> 1</span> <span class="tok-c1">// Test program for ConcreteSubject, NameObserver and PriceObserver</span>
<span class="lineno"> 2</span> <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestObservers</span> <span class="tok-o">{</span>
<span class="lineno"> 3</span>   <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">args</span><span class="tok-o">[])</span> <span class="tok-o">{</span>
<span class="lineno"> 4</span>     <span class="tok-c1">// Create the Subject and Observers.</span>
<span class="lineno"> 5</span>     <span class="tok-n">ConcreteSubject</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">ConcreteSubject</span><span class="tok-o">(</span><span class="tok-s">&quot;Corn Pops&quot;</span><span class="tok-o">,</span> <span class="tok-mf">1.29f</span><span class="tok-o">);</span>
<span class="lineno"> 6</span>     <span class="tok-n">NameObserver</span> <span class="tok-n">nameObs</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">NameObserver</span><span class="tok-o">();</span>
<span class="lineno"> 7</span>     <span class="tok-n">PriceObserver</span> <span class="tok-n">priceObs</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">PriceObserver</span><span class="tok-o">();</span>
<span class="lineno"> 8</span>     <span class="tok-c1">// Add those Observers!</span>
<span class="lineno"> 9</span>     <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">addObserver</span><span class="tok-o">(</span><span class="tok-n">nameObs</span><span class="tok-o">);</span>
<span class="lineno">10</span>     <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">addObserver</span><span class="tok-o">(</span><span class="tok-n">priceObs</span><span class="tok-o">);</span>
<span class="lineno">11</span>     <span class="tok-c1">// Make changes to the Subject.</span>
<span class="lineno">12</span>     <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">setName</span><span class="tok-o">(</span><span class="tok-s">&quot;Frosted Flakes&quot;</span><span class="tok-o">);</span>
<span class="lineno">13</span>     <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">setPrice</span><span class="tok-o">(</span><span class="tok-mf">4.57f</span><span class="tok-o">);</span>
<span class="lineno">14</span>     <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">setPrice</span><span class="tok-o">(</span><span class="tok-mf">9.22f</span><span class="tok-o">);</span>
<span class="lineno">15</span>     <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">setName</span><span class="tok-o">(</span><span class="tok-s">&quot;Sugar Crispies&quot;</span><span class="tok-o">);</span>
<span class="lineno">16</span>   <span class="tok-o">}</span>
<span class="lineno">17</span> <span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="paragraph">
<p>Donnez la trace d&#8217;exécution du code ci-dessus.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_limitations_of_observable_observer_in_java"><a class="link" href="#_limitations_of_observable_observer_in_java">4.4. Limitations of Observable/Observer in Java</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Problem</dt>
<dd>
<p>Suppose the class which we want to be an observable is already part of an
inheritance hierarchy, e.g.,:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="lineno">1</span> <span class="tok-kd">class</span> <span class="tok-nc">SpecialSubject</span> <span class="tok-kd">extends</span> <span class="tok-n">ParentClass</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="paragraph">
<p>Since <a href="https://www.java.com/fr/">Java</a> does not support multiple inheritance, how can we have
<code>ConcreteSubject</code> extend both <code>Observable</code> and <code>ParentClass</code> ?</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Propose a solution</p>
</li>
<li>
<p>Define its corresponding class diagram</p>
</li>
<li>
<p>Write the <a href="https://www.java.com/fr/">Java</a> implementations (mainly <code>SpecialSubject</code>)</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="images/icons/tip.png" alt="Tip">
</td>
<td class="content">
Two methods of <code>java.util.Observable</code> are <strong>protected</strong> methods: <code>setChanged()</code>
and <code>clearChanged()</code>.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can use the following test code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span class="tok-c1">// Test program for SpecialSubject with a Delegated Observable.</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestSpecial</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">args</span><span class="tok-o">[])</span> <span class="tok-o">{</span>
    <span class="tok-c1">// Create the Subject and Observers.</span>
    <span class="tok-n">SpecialSubject</span> <span class="tok-n">s</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">SpecialSubject</span><span class="tok-o">(</span><span class="tok-s">&quot;Corn Pops&quot;</span><span class="tok-o">,</span> <span class="tok-mf">1.29f</span><span class="tok-o">);</span>
    <span class="tok-n">NameObserver</span> <span class="tok-n">nameObs</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">NameObserver</span><span class="tok-o">();</span>
    <span class="tok-n">PriceObserver</span> <span class="tok-n">priceObs</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-nf">PriceObserver</span><span class="tok-o">();</span>
    <span class="tok-c1">// Add those Observers!</span>
    <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">getObservable</span><span class="tok-o">().</span><span class="tok-na">addObserver</span><span class="tok-o">(</span><span class="tok-n">nameObs</span><span class="tok-o">);</span>
    <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">getObservable</span><span class="tok-o">().</span><span class="tok-na">addObserver</span><span class="tok-o">(</span><span class="tok-n">priceObs</span><span class="tok-o">);</span>
    <span class="tok-c1">// Make changes to the Subject.</span>
    <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">setName</span><span class="tok-o">(</span><span class="tok-s">&quot;Frosted Flakes&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">setPrice</span><span class="tok-o">(</span><span class="tok-mf">4.57f</span><span class="tok-o">);</span>
    <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">setPrice</span><span class="tok-o">(</span><span class="tok-mf">9.22f</span><span class="tok-o">);</span>
    <span class="tok-n">s</span><span class="tok-o">.</span><span class="tok-na">setName</span><span class="tok-o">(</span><span class="tok-s">&quot;Sugar Crispies&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Qui produit le résultat suivant :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ConcreteSubject created: Corn Pops at 1.29
NameObserver created: Name is null
PriceObserver created: Price is 0.0
PriceObserver: Some other change to subject!
NameObserver: Name changed to Frosted Flakes
PriceObserver: Price changed to 4.57
PriceObserver: Price changed to 9.22
PriceObserver: Some other change to subject!
NameObserver: Name changed to Sugar Crispies</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="paragraph">
<p>After studying the solution with your favorite teacher:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Do you see a problem to this implementation?</p>
</li>
<li>
<p>Can you provide a solution?</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="paragraph">
<p>Hence how to you modify the test?</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pour_aller_plus_loin"><a class="link" href="#_pour_aller_plus_loin">Pour aller plus loin</a></h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="title"><strong>QUESTION</strong></div>
<div class="ulist">
<ul>
<li>
<p>Pour l&#8217;exemple du <code>price</code> et du <code>name</code>, on aurait pu faire
que seuls les <code>PriceObserver</code> soient notifiés d&#8217;un changement
de prix et que seuls les <code>NameObserver</code> soient notifiés d&#8217;un
changement de nom. Comment faire?</p>
</li>
<li>
<p>Faire le lien avec les listeners vus en Swing</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_about"><a class="link" href="#_about">About&#8230;&#8203;</a></h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Document réalisé via <a href="http://asciidoctor.org/">Asciidoctor</a> (version <code>1.5.2</code>) de 'Dan Allen', lui même basé sur <a href="http://www.methods.co.nz/asciidoc">AsciiDoc</a>.
  Pour l&#8217;instant ce document est libre d&#8217;utilisation et géré par la 'Licence Creative Commons'.
  <span class="image"><a class="image" href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="images/88x31.png" alt="Licence Creative   Commons"></a></span>
  <a href="http://creativecommons.org/licenses/by-sa/3.0/">licence Creative Commons Paternité - Partage à l&#39;Identique 3.0 non transposé</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-12-14 21:56:22 CET
</div>
</div>
</body>
</html>